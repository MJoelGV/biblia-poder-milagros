<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escuchar Biblia - Biblia de Poder y Milagros</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        /* Estilos básicos */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }

        .player-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .book-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .form-select {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 16px;
            flex: 1;
            min-width: 200px;
        }

        .player-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
        }

        .player-button {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        .player-button:hover {
            background: #45a049;
        }

        .player-button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        .progress-container {
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 5px;
            background: #e0e0e0;
            border-radius: 5px;
            margin: 10px 0;
            cursor: pointer;
        }

        .progress {
            height: 100%;
            background: #4CAF50;
            border-radius: 5px;
            width: 0%;
            transition: width 0.1s;
        }

        .time {
            display: flex;
            justify-content: space-between;
            color: #666;
            font-size: 14px;
        }

        #now-playing {
            text-align: center;
            margin: 20px 0;
            font-size: 18px;
            color: #2c3e50;
            min-height: 27px;
        }

        @media (max-width: 600px) {
            .book-selector {
                flex-direction: column;
            }
            
            .form-select {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Biblia en Audio</h1>
        
        <div class="player-container">
            <div class="book-selector">
                <select id="book-select" class="form-select">
                    <option value="">Selecciona un libro</option>
                </select>
                
                <select id="chapter-select" class="form-select" disabled>
                    <option value="">Selecciona un capítulo</option>
                </select>
            </div>
            
            <div id="now-playing"></div>
            
            <div class="player-controls">
                <button id="prev-button" class="player-button" title="Anterior" disabled>
                    <i class="fas fa-step-backward"></i>
                </button>
                <button id="play-button" class="player-button" title="Reproducir">
                    <i class="fas fa-play"></i>
                </button>
                <button id="pause-button" class="player-button" title="Pausar" style="display: none;">
                    <i class="fas fa-pause"></i>
                </button>
                <button id="stop-button" class="player-button" title="Detener">
                    <i class="fas fa-stop"></i>
                </button>
                <button id="next-button" class="player-button" title="Siguiente" disabled>
                    <i class="fas fa-step-forward"></i>
                </button>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar">
                    <div class="progress" id="progress"></div>
                </div>
                <div class="time">
                    <span id="current-time">0:00</span>
                    <span id="duration">0:00</span>
                </div>
            </div>
            
            <audio id="audio-player"></audio>
        </div>
    </div>

    <!-- Scripts al final del body para asegurar que el DOM esté cargado -->
    <script>
        // Variables globales
        let audioPlayer, playBtn, pauseBtn, stopBtn, prevBtn, nextBtn, progressBar, progress, currentTimeEl, durationEl, nowPlayingEl, bookSelect, chapterSelect;
        // Inicializar variables globales
        function initVariables() {
            audioPlayer = document.getElementById('audio-player');
            playBtn = document.getElementById('play-button');
            pauseBtn = document.getElementById('pause-button');
            stopBtn = document.getElementById('stop-button');
            prevBtn = document.getElementById('prev-button');
            nextBtn = document.getElementById('next-button');
            progressBar = document.getElementById('progress-bar');
            progress = document.getElementById('progress');
            currentTimeEl = document.getElementById('current-time');
            durationEl = document.getElementById('duration');
            nowPlayingEl = document.getElementById('now-playing');
            bookSelect = document.getElementById('book-select');
            chapterSelect = document.getElementById('chapter-select');
            
            // Verificar que los elementos del DOM estén disponibles
            console.log('Elementos del DOM cargados:', {
                audioPlayer: !!audioPlayer,
                bookSelect: !!bookSelect,
                chapterSelect: !!chapterSelect
            });
        }
        
        // Mapa de libros con su cantidad de capítulos
        const bookChapters = {
            'genesis': 50, 'exodus': 40, 'lev': 27, 'num': 36, 'deu': 34,
            'joshua': 24, 'judges': 21, 'ruth': 4, '1sam': 31, '2sam': 24,
            '1kin': 22, '2kin': 25, '1chron': 29, '2chron': 36, 'ezra': 10,
            'nehemiah': 13, 'esther': 10, 'job': 42, 'psalm': 150, 'proverbs': 31,
            'ecc': 12, 'song': 8, 'isaiah': 66, 'jere': 52, 'lam': 5, 'ezek': 48,
            'dan': 12, 'hosea': 14, 'joel': 3, 'amos': 9, 'oba': 1, 'jonah': 4,
            'micah': 7, 'nahum': 3, 'habak': 3, 'zeph': 3, 'haggai': 2, 'zech': 14,
            'mal': 4, 'matt': 28, 'mark': 16, 'luke': 24, 'john': 21, 'acts': 28,
            'romans': 16, '1cor': 16, '2cor': 13, 'gal': 6, 'eph': 6, 'phil': 4,
            'col': 4, '1the': 5, '2the': 3, '1tim': 6, '2tim': 4, 'tit': 3,
            'philem': 1, 'heb': 13, 'jam': 5, '1pet': 5, '2pet': 3, '1joh': 5,
            '2joh': 1, '3joh': 1, 'jude': 1, 'rev': 22
        };
        
        // Mapeo de códigos de libros a nombres de archivo
        const bookFileNames = {
            'genesis': 'gen', 'exodus': 'exod', 'lev': 'lev', 'num': 'num', 'deu': 'deut',
            'joshua': 'josh', 'judges': 'judg', 'ruth': 'ruth', '1sam': '1sam', '2sam': '2sam',
            '1kin': '1kings', '2kin': '2kings', '1chron': '1chron', '2chron': '2chron', 'ezra': 'ezra',
            'nehemiah': 'neh', 'esther': 'esth', 'job': 'job', 'psalm': 'ps', 'proverbs': 'prov',
            'ecc': 'eccles', 'song': 'song', 'isaiah': 'isa', 'jere': 'jer', 'lam': 'lam', 'ezek': 'ezek',
            'dan': 'dan', 'hosea': 'hos', 'joel': 'joel', 'amos': 'amos', 'oba': 'obad', 'jonah': 'jonah',
            'micah': 'micah', 'nahum': 'nahum', 'habak': 'hab', 'zeph': 'zeph', 'haggai': 'hag', 'zech': 'zech',
            'mal': 'mal', 'matt': 'matt', 'mark': 'mark', 'luke': 'luke', 'john': 'john', 'acts': 'acts',
            'romans': 'rom', '1cor': '1cor', '2cor': '2cor', 'gal': 'gal', 'eph': 'eph', 'phil': 'phil',
            'col': 'col', '1the': '1thess', '2the': '2thess', '1tim': '1tim', '2tim': '2tim', 'tit': 'titus',
            'philem': 'philem', 'heb': 'heb', 'jam': 'james', '1pet': '1pet', '2pet': '2pet', '1joh': '1john',
            '2joh': '2john', '3joh': '3john', 'jude': 'jude', 'rev': 'rev'
        };
        
        // Nombres para mostrar de los libros
        const bookDisplayNames = {
            'genesis': 'Génesis', 'exodus': 'Éxodo', 'lev': 'Levítico', 'num': 'Números', 'deu': 'Deuteronomio',
            'joshua': 'Josué', 'judges': 'Jueces', 'ruth': 'Rut', '1sam': '1 Samuel', '2sam': '2 Samuel',
            '1kin': '1 Reyes', '2kin': '2 Reyes', '1chron': '1 Crónicas', '2chron': '2 Crónicas',
            'ezra': 'Esdras', 'nehemiah': 'Nehemías', 'esther': 'Ester', 'job': 'Job', 'psalm': 'Salmos',
            'proverbs': 'Proverbios', 'ecc': 'Eclesiastés', 'song': 'Cantares', 'isaiah': 'Isaías', 'jere': 'Jeremías',
            'lam': 'Lamentaciones', 'ezek': 'Ezequiel', 'dan': 'Daniel', 'hosea': 'Oseas', 'joel': 'Joel', 'amos': 'Amós',
            'oba': 'Abdías', 'jonah': 'Jonás', 'micah': 'Miqueas', 'nahum': 'Nahúm', 'habak': 'Habacuc', 'zeph': 'Sofonías',
            'haggai': 'Hageo', 'zech': 'Zacarías', 'mal': 'Malaquías', 'matt': 'Mateo', 'mark': 'Marcos', 'luke': 'Lucas',
            'john': 'Juan', 'acts': 'Hechos', 'romans': 'Romanos', '1cor': '1 Corintios', '2cor': '2 Corintios', 'gal': 'Gálatas',
            'eph': 'Efesios', 'phil': 'Filipenses', 'col': 'Colosenses', '1the': '1 Tesalonicenses', '2the': '2 Tesalonicenses',
            '1tim': '1 Timoteo', '2tim': '2 Timoteo', 'tit': 'Tito', 'philem': 'Filemón', 'heb': 'Hebreos', 'jam': 'Santiago',
            '1pet': '1 Pedro', '2pet': '2 Pedro', '1joh': '1 Juan', '2joh': '2 Juan', '3joh': '3 Juan', 'jude': 'Judas', 'rev': 'Apocalipsis'
        };
        
        // Cargar la lista de libros
        function loadBooks() {
            console.log('Iniciando carga de libros...');
            
            // Verificar que el selector de libros existe
            if (!bookSelect) {
                console.error('Error: No se encontró el selector de libros');
                return;
            }
            
            // Limpiar opciones existentes
            bookSelect.innerHTML = '<option value="">Selecciona un libro</option>';
            
            try {
                // Usar directamente las claves de bookChapters para mantener el orden canónico
                const bookIds = Object.keys(bookChapters);
                console.log('Libros encontrados:', bookIds.length);
                
                // Agregar cada libro al selector
                bookIds.forEach(bookId => {
                    const displayName = bookDisplayNames[bookId];
                    if (displayName) {
                        const option = document.createElement('option');
                        option.value = bookId;
                        option.textContent = displayName;
                        bookSelect.appendChild(option);
                    }
                });
                
                console.log('Libros cargados exitosamente');
            } catch (error) {
                console.error('Error al cargar los libros:', error);
            }
        }
        
        // Cargar capítulos para un libro
        function loadChapters(bookId) {
            // Limpiar opciones existentes
            chapterSelect.innerHTML = '<option value="">Selecciona un capítulo</option>';
            
            // Obtener el número de capítulos para el libro seleccionado
            const numChapters = bookChapters[bookId] || 0;
            
            if (numChapters > 0) {
                // Habilitar el selector de capítulos
                chapterSelect.disabled = false;
                
                // Agregar opciones de capítulos
                for (let i = 1; i <= numChapters; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = `Capítulo ${i}`;
                    chapterSelect.appendChild(option);
                }
            } else {
                // Deshabilitar el selector si no hay capítulos
                chapterSelect.disabled = true;
            }
        }
        
        // Reproducir un capítulo específico
        function playChapter(bookId, chapter) {
            const bookName = bookDisplayNames[bookId] || bookId;
            const fileName = bookFileNames[bookId] || bookId;
            
            // Construir la ruta del archivo de audio
            const audioFile = `./audio/${fileName}_${chapter.toString().padStart(2, '0')}.mp3`;
            
            // Actualizar la interfaz
            nowPlayingEl.textContent = `${bookName} - Capítulo ${chapter}`;
            
            // Configurar y reproducir el audio
            audioPlayer.src = audioFile;
            audioPlayer.load();
            audioPlayer.play()
                .then(() => {
                    console.log(`Reproduciendo: ${bookName} - Capítulo ${chapter}`);
                    playBtn.style.display = 'none';
                    pauseBtn.style.display = 'inline-flex';
                })
                .catch(error => {
                    console.error('Error al reproducir el audio:', error);
                    nowPlayingEl.textContent = `Error al reproducir ${bookName} - Capítulo ${chapter}`;
                });
        }
        
        // Inicializar la aplicación
        function initApp() {
            console.log('Inicializando aplicación...');
            initVariables();
            
            // Cargar la lista de libros
            console.log('Cargando lista de libros...');
            loadBooks();
            
            // Verificar que los libros se cargaron
            setTimeout(() => {
                console.log('Libros cargados:', bookSelect ? bookSelect.options.length - 1 : 0);
                if (bookSelect && bookSelect.options.length <= 1) {
                    console.error('No se cargaron los libros. Verifica la consola para más detalles.');
                }
            }, 100);
            
            // Manejar cambio de libro
            bookSelect.addEventListener('change', (e) => {
                const bookId = e.target.value;
                if (bookId) {
                    loadChapters(bookId);
                } else {
                    chapterSelect.innerHTML = '<option value="">Selecciona un capítulo</option>';
                    chapterSelect.disabled = true;
                }
            });
            
            // Manejar cambio de capítulo
            chapterSelect.addEventListener('change', (e) => {
                const bookId = bookSelect.value;
                const chapter = e.target.value;
                
                if (bookId && chapter) {
                    playChapter(bookId, chapter);
                }
            });
            
            // Controles de reproducción
            playBtn.addEventListener('click', () => {
                audioPlayer.play();
                playBtn.style.display = 'none';
                pauseBtn.style.display = 'inline-flex';
            });
            
            pauseBtn.addEventListener('click', () => {
                audioPlayer.pause();
                pauseBtn.style.display = 'none';
                playBtn.style.display = 'inline-flex';
            });
            
            stopBtn.addEventListener('click', () => {
                audioPlayer.pause();
                audioPlayer.currentTime = 0;
                pauseBtn.style.display = 'none';
                playBtn.style.display = 'inline-flex';
            });
            
            // Actualizar barra de progreso
            audioPlayer.addEventListener('timeupdate', () => {
                const { currentTime, duration } = audioPlayer;
                const progressPercent = (currentTime / duration) * 100;
                progress.style.width = `${progressPercent}%`;
                
                // Actualizar tiempos
                currentTimeEl.textContent = formatTime(currentTime);
                
                if (!isNaN(duration)) {
                    durationEl.textContent = formatTime(duration);
                }
            });
            
            // Permitir hacer clic en la barra de progreso
            progressBar.addEventListener('click', (e) => {
                const rect = progressBar.getBoundingClientRect();
                const pos = (e.clientX - rect.left) / rect.width;
                audioPlayer.currentTime = pos * audioPlayer.duration;
            });
            
            // Manejar el final de la reproducción
            audioPlayer.addEventListener('ended', () => {
                pauseBtn.style.display = 'none';
                playBtn.style.display = 'inline-flex';
                progress.style.width = '0%';
                currentTimeEl.textContent = '0:00';
            });
        });
        
        // Función para formatear el tiempo (MM:SS)
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
        // Iniciar la aplicación cuando el DOM esté completamente cargado
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    </script>
</body>
</html>
