<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan IPHC - Biblia en un Año - Biblia de Poder y Milagros</title>
    <link rel="stylesheet" href="../styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            background-color: #f5f7fa;
        }
        .header {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: linear-gradient(135deg, #2c3e50, #4ca1af);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .header h1 {
            font-family: 'Great Vibes', cursive;
            font-size: 3.5em;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .header p {
            font-size: 1.2em;
            margin: 10px 0 0;
            opacity: 0.9;
        }
        .progress-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        .progress-bar {
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            margin-top: 10px;
            overflow: hidden;
        }
        .progress {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
            position: relative;
        }
        .progress-text {
            position: absolute;
            right: 10px;
            color: white;
            font-weight: bold;
            font-size: 0.8em;
            line-height: 20px;
            text-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
        }
        .months-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .month-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .month-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .month-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .month-title {
            min-width: 100px;
        }
        .month-title {
            font-size: 1.5em;
            color: #2c3e50;
            margin: 0;
        }
        .month-progress-container {
            flex: 1;
            margin-left: 15px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        
        .month-progress-text {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-bottom: 4px;
        }
        
        .month-progress-bar {
            width: 100%;
            max-width: 200px;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .month-progress-bar .progress-text {
            display: none; /* Ocultar el texto en la barra de progreso del mes */
        }
        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }
        .day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            position: relative;
            background: #f8f9fa;
            border: 2px solid transparent;
        }
        .day:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }
        .day.completed {
            background-color: #2ecc71;
            color: white;
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }
        
        /* Efecto de resaltado al marcar como completado */
        .day.just-updated {
            animation: highlight 0.5s ease-out;
            transform: scale(1.1);
            z-index: 2;
            box-shadow: 0 0 10px rgba(46, 204, 113, 0.8);
        }
        
        @keyframes highlight {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); }
            50% { transform: scale(1.1); box-shadow: 0 0 15px 5px rgba(46, 204, 113, 0.6); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
        }
        
        .day.today {
            border-color: #3498db;
            background: #e3f2fd;
            font-weight: bold;
        }
        .day.future {
            color: #95a5a6;
            cursor: not-allowed;
        }
        .day-number {
            font-size: 0.9em;
        }
        .reading-preview {
            display: none;
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: #2c3e50;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8em;
            white-space: nowrap;
            z-index: 10;
            pointer-events: none;
        }
        .day:hover .reading-preview {
            display: block;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary {
            background: #3498db;
            color: white;
        }
        .btn-primary:hover {
            background: #2980b9;
        }
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .reading-plan-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }
        @media (max-width: 768px) {
            .months-grid {
                grid-template-columns: 1fr;
            }
            .header h1 {
                font-size: 2.5em;
            }
        }

        /* Estilos para el menú lateral */
        .side-menu {
            position: fixed;
            left: -300px;
            top: 0;
            width: 280px;
            height: 100%;
            background: #2c3e50;
            color: white;
            transition: left 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0,0,0,0.2);
        }

        .side-menu.active {
            left: 0;
        }

        .menu-header {
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .close-menu {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px 10px;
        }

        .menu-toggle {
            position: fixed;
            top: 15px;
            left: 15px;
            background: #3498db;
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            z-index: 900;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .side-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .side-menu li {
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .side-menu li a {
            display: block;
            padding: 15px 20px;
            color: #ecf0f1;
            text-decoration: none;
            transition: background 0.3s;
            display: flex;
            align-items: center;
        }

        .side-menu li a:hover,
        .side-menu li.active a {
            background: #34495e;
        }

        .side-menu li a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* Overlay cuando el menú está abierto */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 990;
        }

        .overlay.active {
            display: block;
        }

        /* Ajustar el contenido cuando el menú está abierto */
        body.menu-open {
            overflow: hidden;
        }

        /* Estilos para el encabezado */
        .header {
            padding: 20px 20px 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
            text-align: center;
            position: relative;
        }

        .header-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
            color: #2c3e50;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .header p {
            margin: 0;
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .header p {
                font-size: 1em;
            }
        }

        /* Estilos para el modal */
        .reading-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .reading-modal.active {
            display: flex;
            opacity: 1;
        }

        .reading-modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            position: relative;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        .reading-modal.active .reading-modal-content {
            transform: translateY(0);
        }

        .reading-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .reading-modal-title {
            margin: 0;
            color: #2c3e50;
            font-size: 1.5em;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #7f8c8d;
            padding: 5px;
        }

        .reading-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .reading-item {
            margin-bottom: 12px;
            font-size: 1.1em;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .reading-item:last-child {
            border-bottom: none;
        }

        .reading-link {
            color: #2c3e50;
            text-decoration: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .reading-link:hover {
            background-color: #f8f9fa;
            color: #e74c3c;
            text-decoration: none;
            transform: translateX(5px);
        }
        
        .external-icon {
            margin-left: 8px;
            font-size: 0.9em;
            opacity: 0.7;
        }

        .complete-btn {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.2s ease;
            white-space: nowrap;
        }

        .complete-btn:hover {
            background: #43a047;
        }

        .complete-btn.completed {
            background: #95a5a6;
        }

        .day-label {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <!-- Menú lateral -->
    <div id="side-menu" class="side-menu">
        <div class="menu-header">
            <span>Menú</span>
            <button class="close-menu" onclick="toggleMenu()">&times;</button>
        </div>
        <ul>
            <li><a href="../index.html"><i class="fas fa-home"></i> Inicio</a></li>
            <li><a href="../lectura.html"><i class="fas fa-book"></i> Leer Biblia</a></li>
            <li><a href="../pericopas-standalone.html"><i class="fas fa-list"></i> Perícopas</a></li>
            <li><a href="../audio.html"><i class="fas fa-headphones"></i> Escuchar</a></li>
            <li><a href="30-dias-con-jesus.html"><i class="fas fa-calendar-check"></i> 30 Días con Jesús</a></li>
            <li><a href="iphc-1-ano.html" class="active"><i class="fas fa-bible"></i> Plan IPHC</a></li>
        </ul>
    </div>
    
    <!-- Botón para abrir el menú -->
    <button class="menu-toggle" onclick="toggleMenu()">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Overlay para cerrar el menú -->
    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>
    
    <div class="header">
        <div class="header-content">
            <h1>Biblia en un Año</h1>
            <p>Un viaje de un año a través de la Palabra de Dios</p>
        </div>
    </div>

    <div class="progress-container">
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
            <span>Progreso general</span>
            <span id="overall-progress">0%</span>
        </div>
        <div class="progress-bar">
            <div class="progress" id="overall-progress-bar">
                <span class="progress-text">0%</span>
            </div>
        </div>
    </div>

    <div class="reading-plan-actions">
        <button class="btn btn-primary" id="reset-progress">
            <i class="fas fa-redo"></i> Reiniciar Progreso
        </button>
    </div>

    <div class="months-grid" id="months-container">
        <!-- Los meses se insertarán aquí mediante JavaScript -->
    </div>

    <!-- Modal para mostrar las lecturas del día -->
    <div class="reading-modal" id="reading-modal">
        <div class="reading-modal-content">
            <div class="reading-modal-header">
                <h3 class="reading-modal-title" id="modal-day-title">Lecturas del día</h3>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <div class="day-label" id="modal-date">1 de Enero</div>
            <ul class="reading-list" id="reading-list">
                <!-- Las lecturas se insertarán aquí dinámicamente -->
            </ul>
            <div class="modal-actions" style="margin-top: 20px; display: flex; justify-content: flex-end;">
                <button class="complete-btn" id="complete-day-btn">Marcar como completado</button>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let currentDay = null;
        let currentMonth = null;
        let currentYear = new Date().getFullYear();
        let currentDayOfMonth = new Date().getDate();
        let currentMonthIndex = new Date().getMonth();
        const modal = document.getElementById('reading-modal');
        const modalContent = document.querySelector('.modal-content');
        const closeModalBtn = document.querySelector('.close-modal');
        const completeDayBtn = document.getElementById('complete-day-btn');
        
        // Actualizar el año en el título
        document.addEventListener('DOMContentLoaded', () => {
            const yearElement = document.getElementById('current-year');
            if (yearElement) {
                yearElement.textContent = currentYear;
            }
        });
        const readingList = document.getElementById('reading-list');
        const modalDayTitle = document.getElementById('modal-day-title');
        const modalDate = document.getElementById('modal-date');
        
        // Datos del plan de lectura IPHC
        const readingPlan = [
            {
                month: "Enero",
                days: 31,
                completed: 0,
                readings: [
                    "Juan 1:1-18",
                    "Génesis 1-4",
                    "Génesis 5-8",
                    "Génesis 9-12",
                    "Salmos 1-3",
                    "Génesis 13-16",
                    "Génesis 17-19",
                    "Génesis 20-22",
                    "Job 1-3",
                    "Job 4-7",
                    "Job 8-11",
                    "Salmos 4-7",
                    "Job 12-14",
                    "Job 15-17",
                    "Job 18-21",
                    "Job 22-25",
                    "Job 26-31",
                    "Job 32-34",
                    "Salmos 8-11",
                    "Job 35-37",
                    "Job 38-42",
                    "Génesis 23-26",
                    "Génesis 27-30",
                    "Génesis 31-34",
                    "Génesis 35-38",
                    "Salmos 12-14",
                    "Génesis 39-42",
                    "Génesis 43-46",
                    "Génesis 47-50",
                    "Éxodo 1-3",
                    "Éxodo 4-6"
                ]
            },
            {
                month: "Febrero",
                days: 29, // Ajustar para años bisiestos
                completed: 0,
                readings: [
                    "Éxodo 7-9",
                    "Salmos 15-17",
                    "Éxodo 10-12",
                    "Éxodo 13-15",
                    "Éxodo 16-18",
                    "Éxodo 19-21",
                    "Éxodo 22-24",
                    "Éxodo 25-27",
                    "Salmos 18-20",
                    "Éxodo 28-30",
                    "Éxodo 31-33",
                    "Éxodo 34-37",
                    "Éxodo 38-40",
                    "Levítico 1-3",
                    "Levítico 4-6",
                    "Salmos 21-23",
                    "Levítico 7-9",
                    "Levítico 10-12",
                    "Levítico 13-15",
                    "Levítico 16-18",
                    "Levítico 19-21",
                    "Levítico 22-24",
                    "Salmos 24-26",
                    "Levítico 25-27",
                    "Números 1-3",
                    "Números 4-6",
                    "Números 7-9",
                    "Números 10-12",
                    "Números 13-15"
                ]
            },
            {
                month: "Marzo",
                days: 31,
                completed: 0,
                readings: [
                    "Números 13-15",
                    "Salmos 27-29",
                    "Números 16-18",
                    "Números 19-21",
                    "Números 22-24",
                    "Números 25-27",
                    "Números 28-30",
                    "Números 31-33",
                    "Salmos 30-32",
                    "Números 34-36",
                    "Deuteronomio 1-3",
                    "Deuteronomio 4-6",
                    "Deuteronomio 7-9",
                    "Deuteronomio 10-12",
                    "Deuteronomio 13-15",
                    "Salmos 33-35",
                    "Deuteronomio 16-18",
                    "Deuteronomio 19-21",
                    "Deuteronomio 22-24",
                    "Deuteronomio 25-27",
                    "Deuteronomio 28-30",
                    "Deuteronomio 31-34",
                    "Salmos 36-38",
                    "Josué 1-3",
                    "Josué 4-6",
                    "Josué 7-9",
                    "Josué 10-12",
                    "Josué 13-15",
                    "Josué 16-18",
                    "Salmos 39-41",
                    "Josué 19-21"
                ]
            },
            {
                month: "Abril",
                days: 30,
                completed: 0,
                readings: [
                    "Josué 22-24",
                    "Jueces 1-3",
                    "Jueces 4-6",
                    "Jueces 7-9",
                    "Jueces 10-12",
                    "Salmos 42-44",
                    "Jueces 13-15",
                    "Jueces 16-18",
                    "Jueces 19-21",
                    "Rut 1-4",
                    "1 Samuel 1-3",
                    "1 Samuel 4-6",
                    "Salmos 45-47",
                    "1 Samuel 7-9",
                    "1 Samuel 10-13",
                    "1 Samuel 14-16",
                    "1 Samuel 17-19",
                    "1 Samuel 20-22",
                    "1 Samuel 23-25",
                    "Salmos 48-50",
                    "1 Samuel 26-28",
                    "1 Samuel 29-31",
                    "2 Samuel 1-3",
                    "2 Samuel 4-6",
                    "2 Samuel 7-9",
                    "2 Samuel 10-12",
                    "Salmos 51-53",
                    "2 Samuel 13-15",
                    "2 Samuel 16-18",
                    "2 Samuel 19-21"
                ]
            },
            {
                month: "Mayo",
                days: 31,
                completed: 0,
                readings: [
                    "2 Samuel 22-24",
                    "1 Reyes 1-4",
                    "Proverbios 1-3",
                    "Salmos 54-56",
                    "Proverbios 4-6",
                    "Proverbios 7-9",
                    "Proverbios 10-12",
                    "Proverbios 13-15",
                    "Proverbios 16-18",
                    "Proverbios 19-21",
                    "Salmos 57-59",
                    "Proverbios 22-24",
                    "Proverbios 25-27",
                    "Proverbios 28-31",
                    "Cantares 1-4",
                    "Cantares 5-8",
                    "1 Reyes 5-7",
                    "Salmos 60-62",
                    "1 Reyes 8-11",
                    "Eclesiastés 1-4",
                    "Eclesiastés 5-8",
                    "Eclesiastés 9-12",
                    "1 Reyes 12-14",
                    "1 Reyes 15-17",
                    "Salmos 63-65",
                    "1 Reyes 18-20",
                    "1 Reyes 21-22, 2 Reyes 1",
                    "2 Reyes 2-4",
                    "2 Reyes 5-7",
                    "2 Reyes 8-10",
                    "2 Reyes 11-14"
                ]
            },
            {
                month: "Junio",
                days: 30,
                completed: 0,
                readings: [
                    "Salmos 66-68",
                    "Jonás",
                    "Amós 1-3",
                    "Amós 4-6",
                    "Amós 7-9",
                    "2 Reyes 15-17",
                    "2 Reyes 18-21",
                    "Salmos 69-71",
                    "2 Reyes 22-25",
                    "1 Crónicas 1-3",
                    "1 Crónicas 4-6",
                    "1 Crónicas 7-9",
                    "1 Crónicas 10-12",
                    "1 Crónicas 13-16",
                    "Salmos 72-74",
                    "1 Crónicas 17-19",
                    "1 Crónicas 20-22",
                    "1 Crónicas 23-25",
                    "1 Crónicas 26-29",
                    "2 Crónicas 1-3",
                    "2 Crónicas 4-6",
                    "Salmos 75-77",
                    "2 Crónicas 7-9",
                    "2 Crónicas 10-12",
                    "2 Crónicas 13-15",
                    "2 Crónicas 16-18",
                    "2 Crónicas 19-22",
                    "Joel, Abdías",
                    "Salmos 78-80",
                    "2 Crónicas 23-26"
                ]
            },
            {
                month: "Julio",
                days: 31,
                completed: 0,
                readings: [
                    "Isaías 1-3",
                    "Isaías 4-6",
                    "2 Crónicas 27-29",
                    "2 Crónicas 30-32",
                    "Isaías 7-9",
                    "Salmos 81-83",
                    "Isaías 10-12",
                    "Isaías 13-15",
                    "Isaías 16-18",
                    "Isaías 19-21",
                    "Isaías 22-24",
                    "Isaías 25-27",
                    "Salmos 84-86",
                    "Isaías 28-30",
                    "Isaías 31-33",
                    "Isaías 34-36",
                    "Isaías 37-39",
                    "Isaías 40-42",
                    "Isaías 43-45",
                    "Salmos 87-90",
                    "Isaías 46-48",
                    "Isaías 49-51",
                    "Isaías 52-54",
                    "Isaías 55-57",
                    "Isaías 58-60",
                    "Isaías 61-63",
                    "Salmos 91-93",
                    "Isaías 64-66",
                    "Oseas 1-3",
                    "Oseas 4-6",
                    "Oseas 7-9"
                ]
            },
            {
                month: "Agosto",
                days: 31,
                completed: 0,
                readings: [
                    "Oseas 10-12",
                    "Oseas 13-14, Miqueas 1",
                    "Salmos 94-96",
                    "Miqueas 2-4",
                    "Miqueas 5-7",
                    "Nahúm 1-3",
                    "2 Crónicas 33-34, Sofonías 1",
                    "Sofonías 2-3, 2 Crónicas 35",
                    "Habacuc 1-3",
                    "Salmos 97-99",
                    "Jeremías 1-3",
                    "Jeremías 4-6",
                    "Jeremías 11-12, 26",
                    "Jeremías 7-9",
                    "Jeremías 10, 14-15",
                    "Jeremías 16-18",
                    "Salmos 100-102",
                    "Jeremías 19, 20, 35",
                    "Jeremías 25, 36, 45",
                    "Jeremías 46-49",
                    "Jeremías 13, 22-23",
                    "Jeremías 24, 27-28",
                    "Jeremías 29, 50-51",
                    "Salmos 103-105",
                    "Jeremías 30-33",
                    "Jeremías 21, 34, 37",
                    "Jeremías 38-39, 52",
                    "Jeremías 40-42",
                    "Jeremías 43-44, Lamentaciones 1",
                    "Lamentaciones 2-5",
                    "Salmos 106-108"
                ]
            },
            {
                month: "Septiembre",
                days: 30,
                completed: 0,
                readings: [
                    "2 Crónicas 36:1-8, Daniel 1-3",
                    "Daniel 4-6",
                    "Daniel 7-9",
                    "Daniel 10-12",
                    "2 Crónicas 36:9-21, Ezequiel 1-3",
                    "Ezequiel 4-6",
                    "Salmos 109-111",
                    "Ezequiel 7-9",
                    "Ezequiel 10-12",
                    "Ezequiel 13-16",
                    "Ezequiel 17-20",
                    "Ezequiel 21-24",
                    "Ezequiel 25-28",
                    "Salmos 112-114",
                    "Ezequiel 29-32",
                    "Ezequiel 33-36",
                    "Ezequiel 37-40",
                    "Ezequiel 41-44",
                    "Ezequiel 45-48",
                    "2 Crónicas 36:22-23, Esdras 1-3",
                    "Salmos 115-117",
                    "Esdras 4, Hageo 1-2",
                    "Zacarías 1-3",
                    "Zacarías 4-6",
                    "Zacarías 7-9",
                    "Zacarías 10-12",
                    "Zacarías 13-14",
                    "Salmos 118-119:16",
                    "Esdras 5-7",
                    "Esdras 8-10"
                ]
            },
            {
                month: "Octubre",
                days: 31,
                completed: 0,
                readings: [
                    "Ester 1-3",
                    "Ester 4-6",
                    "Ester 7-10",
                    "Nehemías 1-3",
                    "Salmos 119:17-72",
                    "Nehemías 4-6",
                    "Nehemías 7-9",
                    "Nehemías 10-13",
                    "Malaquías",
                    "Mateo 1-3",
                    "Mateo 4-7",
                    "Salmos 119:73-120",
                    "Mateo 8-10",
                    "Mateo 11-13",
                    "Mateo 14-16",
                    "Mateo 17-19",
                    "Mateo 20-22",
                    "Mateo 23-25",
                    "Salmos 119:121-176",
                    "Mateo 26-28",
                    "Marcos 1-4",
                    "Marcos 5-8",
                    "Marcos 9-12",
                    "Marcos 13-16",
                    "Lucas 1-4",
                    "Salmos 120-122",
                    "Lucas 5-8",
                    "Lucas 9-12",
                    "Lucas 13-16",
                    "Lucas 17-20",
                    "Lucas 21-24"
                ]
            },
            {
                month: "Noviembre",
                days: 30,
                completed: 0,
                readings: [
                    "1 Juan 1-3",
                    "Salmos 123-125",
                    "Juan 4-6",
                    "Juan 7-9",
                    "Juan 10-12",
                    "Juan 13-15",
                    "Juan 16-18",
                    "Juan 19-21",
                    "Salmos 126-128",
                    "Hechos 1-4",
                    "Hechos 5:1-8:3",
                    "Hechos 8:4-11",
                    "Hechos 12-14",
                    "Santiago",
                    "Gálatas",
                    "Salmos 129-131",
                    "Hechos 15-16",
                    "Filipenses",
                    "1 Tesalonicenses",
                    "Hechos 17-18:11, 2 Tesalonicenses",
                    "1 Corintios 1-3",
                    "1 Corintios 4-7",
                    "Salmos 132-134",
                    "1 Corintios 8:1-11:1",
                    "1 Corintios 11:2-14:40",
                    "1 Corintios 15-16",
                    "2 Corintios 1-5",
                    "2 Corintios 6-9",
                    "2 Corintios 10-13",
                    "Salmos 135-137"
                ]
            },
            {
                month: "Diciembre",
                days: 31,
                completed: 0,
                readings: [
                    "Hechos 18:12-19:41, Efesios 1-2",
                    "Efesios 3-6",
                    "Romanos 1-3",
                    "Romanos 4-6",
                    "Romanos 7-9",
                    "Romanos 10-12",
                    "Salmos 138-140",
                    "Romanos 13-16",
                    "Hechos 20-22",
                    "Hechos 23-25",
                    "Hechos 26-28",
                    "Colosenses",
                    "Hebreos 1-4",
                    "Salmos 141-143",
                    "Hebreos 5-8",
                    "Hebreos 9-11",
                    "Hebreos 12-13, Tito",
                    "1 Timoteo",
                    "2 Timoteo, Filemón",
                    "1 Pedro",
                    "Salmos 144-146",
                    "1 Juan",
                    "2 Pedro, 2 Juan, 3 Juan, Judas",
                    "Apocalipsis 1-4",
                    "Apocalipsis 5-7",
                    "Apocalipsis 8-11",
                    "Apocalipsis 12-13",
                    "Salmos 147-150",
                    "Apocalipsis 14-16",
                    "Apocalipsis 17-19",
                    "Apocalipsis 20-22"
                ]
            }
        ];

        // Función para inicializar la aplicación
        function scrollToCurrentDay() {
            // Esperar un momento para que se renderice el DOM
            setTimeout(() => {
                const today = new Date();
                const currentDay = today.getDate();
                const currentMonth = today.getMonth();
                
                // Encontrar el elemento del día actual
                const dayElement = document.querySelector(`.day[data-day="${currentDay}"][data-month="${currentMonth}"]`);
                if (dayElement) {
                    // Hacer scroll hasta el día actual
                    dayElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                    // Resaltar el día actual
                    dayElement.classList.add('today');
                    
                    // Abrir automáticamente las lecturas del día
                    openDayReadings(currentDay, currentMonth, currentYear);
                }
            }, 500);
        }

        function initApp() {
            // Asegurarse de que el año sea el actual
            currentYear = new Date().getFullYear();
            currentMonthIndex = new Date().getMonth();
            currentDayOfMonth = new Date().getDate();
            
            // Actualizar el año en la interfaz
            const yearElement = document.getElementById('current-year');
            if (yearElement) {
                yearElement.textContent = currentYear;
            }
            
            loadProgress();
            renderMonths();
            setupEventListeners();
            
            // Hacer scroll al día actual después de que todo esté listo
            scrollToCurrentDay();
        }

        // Función para cargar el progreso guardado
        function loadProgress() {
            // Inicializar contadores de días completados
            const completedDays = JSON.parse(localStorage.getItem('completedDays') || '{}');
            const currentYear = new Date().getFullYear();
            
            // Reiniciar contadores
            readingPlan.forEach(month => {
                month.completed = 0;
                
                // Contar días completados para este mes
                for (let day = 1; day <= month.days; day++) {
                    const dateKey = `${currentYear}-${(readingPlan.findIndex(m => m.month === month.month) + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                    if (completedDays[dateKey]) {
                        month.completed++;
                    }
                }
            });
            
            // Actualizar la interfaz
            updateOverallProgress();
            readingPlan.forEach(month => updateMonthProgress(month.month));
        }

        // Función para guardar el progreso
        function saveProgress() {
            const progressToSave = readingPlan.map(month => ({
                month: month.month,
                completed: month.completed
            }));
            localStorage.setItem('iphcReadingProgress', JSON.stringify(progressToSave));
        }

        // Función para renderizar los días de un mes
        function renderDays(monthData) {
            const daysInMonth = monthData.days;
            const firstDay = new Date(currentYear, monthData.month - 1, 1).getDay();
            const monthIndex = readingPlan.findIndex(m => m.month === monthData.month) + 1;
            const days = [];
            
            // Días en blanco al inicio
            for (let i = 0; i < firstDay; i++) {
                days.push(`<div class="day empty"></div>`);
            }
            
            // Días del mes
            for (let i = 1; i <= daysInMonth; i++) {
                const dayData = monthData.readings ? monthData.readings[i - 1] : null;
                const hasReadings = dayData;
                const dateKey = `${currentYear}-${monthIndex.toString().padStart(2, '0')}-${i.toString().padStart(2, '0')}`;
                const completedDays = JSON.parse(localStorage.getItem('completedDays') || '{}');
                const isCompleted = !!completedDays[dateKey];
                
                days.push(`
                    <div class="day ${hasReadings ? 'has-readings' : ''} ${isCompleted ? 'completed' : ''}" 
                         data-day="${i}" 
                         data-month="${monthIndex}"
                         title="${hasReadings ? dayData : 'No hay lecturas'}"
                         onclick="openDayReadings(${i}, ${monthIndex}, ${currentYear})">
                        ${i}
                    </div>
                `);
            }
            
            return days.join('');
        }

        // Función para renderizar los meses
        function renderMonths() {
            const container = document.getElementById('months-container');
            container.innerHTML = '';
            
            readingPlan.forEach((month, monthIndex) => {
                const monthCard = document.createElement('div');
                monthCard.className = 'month-card';
                monthCard.setAttribute('data-month', month.month);
                
                // Calcular progreso del mes
                const progress = Math.round(((month.completed || 0) / month.days) * 100);
                
                // Generar el HTML de los días
                const daysHtml = renderDays(month);
                
                monthCard.innerHTML = `
                    <div class="month-header">
                        <h3 class="month-title">${month.month}</h3>
                        <div class="month-progress-container">
                            <span class="month-progress-text">${month.completed || 0}/${month.days} días</span>
                            <div class="progress-bar month-progress-bar" style="width: ${progress}%" 
                                 title="Completado: ${month.completed || 0} de ${month.days} días (${progress}%)">
                                <span class="progress-text">${progress}%</span>
                            </div>
                        </div>
                    </div>
                    <div class="days-grid">
                        ${daysHtml}
                    </div>
                `;
                
                container.appendChild(monthCard);
            });
        }

        // Función para verificar si una fecha es hoy
        function isTodayDate(monthIndex, day) {
            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth();
            const currentDay = now.getDate();
            
            // Asumimos que el año comienza en enero (índice 0)
            const targetDate = new Date(currentYear, monthIndex, day);
            
            return (
                targetDate.getDate() === currentDay &&
                targetDate.getMonth() === currentMonth &&
                targetDate.getFullYear() === currentYear
            );
        }

        // Función para verificar si una fecha es futura
        function isFutureDate(monthIndex, day) {
            const now = new Date();
            const currentYear = now.getFullYear();
            const currentDate = new Date(currentYear, now.getMonth(), now.getDate());
            const targetDate = new Date(currentYear, monthIndex, day);
            
            return targetDate > currentDate;
        }

        // Función para actualizar el progreso de un mes específico
        function updateMonthProgress(monthName) {
            const monthIndex = readingPlan.findIndex(m => m.month === monthName);
            if (monthIndex === -1) return;
            
            const month = readingPlan[monthIndex];
            const progress = Math.round((month.completed / month.days) * 100);
            
            // Actualizar la barra de progreso del mes
            const progressBar = document.querySelector(`.month-card[data-month="${monthName}"] .month-progress-bar`);
            if (progressBar) {
                progressBar.style.width = `${progress}%`;
                progressBar.setAttribute('title', `Completado: ${month.completed} de ${month.days} días (${progress}%)`);
            }
            
            // Actualizar el texto de progreso
            const progressText = document.querySelector(`.month-card[data-month="${monthName}"] .month-progress-text`);
            if (progressText) {
                progressText.textContent = `${month.completed}/${month.days} días`;
            }
        }

        // Función para actualizar el progreso general
        function updateOverallProgress() {
            const totalDays = readingPlan.reduce((sum, month) => sum + month.days, 0);
            const completedDays = readingPlan.reduce((sum, month) => sum + (month.completed || 0), 0);
            const progress = Math.round((completedDays / totalDays) * 100);
            
            // Actualizar el progreso general
            const overallProgress = document.getElementById('overall-progress');
            const overallProgressBar = document.getElementById('overall-progress-bar');
            const progressText = document.querySelector('#overall-progress-bar .progress-text');
            
            if (overallProgress) overallProgress.textContent = `${progress}%`;
            if (overallProgressBar) overallProgressBar.style.width = `${progress}%`;
            if (progressText) progressText.textContent = `${progress}%`;
            
            // Actualizar el título de la página
            document.title = `(${completedDays}/${totalDays}) Plan IPHC - Biblia en un Año`;
        }

        // Configurar los event listeners
        function setupEventListeners() {
            // Manejar clic en un día
            document.addEventListener('click', (e) => {
                const dayElement = e.target.closest('.day:not(.future)');
                if (!dayElement || dayElement.classList.contains('future')) return;
                
                const monthIndex = parseInt(dayElement.dataset.month);
                const day = parseInt(dayElement.dataset.day);
                
                // Alternar estado completado
                if (day === readingPlan[monthIndex].completed + 1) {
                    readingPlan[monthIndex].completed = day;
                } else if (day === readingPlan[monthIndex].completed) {
                    readingPlan[monthIndex].completed = day - 1;
                } else {
                    return; // No permitir marcar días futuros o saltarse días
                }
                
                // Guardar y actualizar la interfaz
                saveProgress();
                renderMonths();
                updateOverallProgress();
            });
            
            // Manejar el botón de reiniciar progreso
            document.getElementById('reset-progress').addEventListener('click', () => {
                if (confirm('¿Estás seguro de que deseas reiniciar todo tu progreso?')) {
                    readingPlan.forEach(month => {
                        month.completed = 0;
                    });
                    saveProgress();
                    renderMonths();
                    updateOverallProgress();
                }
            });
        }

        // Función para abrir el modal con las lecturas del día
        function openDayReadings(day, month, year) {
            currentDay = day;
            currentMonth = month;
            currentYear = year;
            
            // Actualizar el título del modal
            const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                              'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            const monthName = monthNames[month-1];
            modalDayTitle.textContent = `Lecturas del día`;
            modalDate.textContent = `${day} de ${monthName} ${year}`;
            
            // Limpiar lecturas anteriores
            readingList.innerHTML = '';
            
            // Obtener las lecturas del día
            const dayReadings = getDayReadings(day, monthName);
            
            if (dayReadings && dayReadings.length > 0) {
                dayReadings.forEach((reading, index) => {
                    // Limpiar y formatear la referencia bíblica
                    let cleanReading = reading.trim();
                    if (!cleanReading) return; // Saltar si está vacío
                    
                    const li = document.createElement('li');
                    li.className = 'reading-item';
                    
                    // Crear enlace a la lectura
                    const link = document.createElement('a');
                    link.href = '#';
                    link.className = 'reading-link';
                    
                    // Formatear el texto para mostrar los capítulos completos
                    let displayText = cleanReading;
                    
                    // Patrón para detectar referencias con rango de capítulos (ej: Génesis 1-4)
                    const chapterRangeMatch = cleanReading.match(/^(\d?\s*[\w\s]+?)\s*(\d+)\s*-\s*(\d+)(?![\d:])/);
                    
                    if (chapterRangeMatch) {
                        const [, book, startChapter, endChapter] = chapterRangeMatch;
                        const start = parseInt(startChapter);
                        const end = parseInt(endChapter);
                        
                        if (start < end) {
                            // Generar lista de capítulos
                            const chapters = [];
                            for (let i = start; i <= end; i++) {
                                chapters.push(i);
                            }
                            
                            // Formatear como "capítulos X, Y y Z"
                            let chaptersText = '';
                            if (chapters.length <= 3) {
                                // Para 2 o 3 capítulos, mostrarlos todos: "1, 2 y 3"
                                chaptersText = chapters.join(', ');
                                const lastComma = chaptersText.lastIndexOf(',');
                                if (lastComma !== -1) {
                                    chaptersText = chaptersText.substring(0, lastComma) + ' y' + chaptersText.substring(lastComma + 1);
                                }
                            } else {
                                // Para más de 3 capítulos, mostrar solo el primero y el último: "1 al 10"
                                chaptersText = `del ${start} al ${end}`;
                            }
                            
                            displayText = `${book.trim()} ${startChapter}-${endChapter} (capítulos ${chaptersText})`;
                        }
                    }
                    
                    link.textContent = displayText;
                    
                    // Función auxiliar para extraer libro y capítulo de una referencia
                    function parseReference(ref) {
                        // Primero intentar con el formato estándar
                        let match = ref.match(/^(\d?\s*[\w\s]+?)\s*(\d+)(?::(\d+)(?:-(\d+))?)?/);
                        if (match) {
                            let [, book, chapter] = match;
                            return { book: book.trim(), chapter };
                        }
                        // Si no coincide, intentar con otros formatos
                        match = ref.match(/^([\w\s]+?)\s+(\d+)/);
                        if (match) {
                            let [, book, chapter] = match;
                            return { book: book.trim(), chapter };
                        }
                        return null;
                    }

                    // Manejar clic en la referencia bíblica
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        
                        // Primero intentar con la referencia completa
                        let refInfo = parseReference(cleanReading);
                        
                        // Si no se pudo analizar, intentar dividir por comas
                        if (!refInfo) {
                            const firstPart = cleanReading.split(',')[0].trim();
                            refInfo = parseReference(firstPart);
                        }
                        
                        if (refInfo) {
                            // Construir URL con el formato correcto: book=Nombre&chapter=XX
                            const url = `../lectura.html?book=${encodeURIComponent(refInfo.book)}&chapter=${refInfo.chapter}`;
                            window.location.href = url;
                        } else {
                            // Si no se pudo analizar, hacer una búsqueda simple
                            window.location.href = `../lectura.html?buscar=${encodeURIComponent(cleanReading)}`;
                        }
                    });
                    
                    // Añadir un ícono de enlace externo
                    const icon = document.createElement('span');
                    icon.className = 'external-icon';
                    icon.innerHTML = '&nearr;';
                    link.appendChild(icon);
                    
                    li.appendChild(link);
                    readingList.appendChild(li);
                });
                
                // Si no se agregó ninguna lectura (todas estaban vacías)
                if (readingList.children.length === 0) {
                    const li = document.createElement('li');
                    li.textContent = 'No hay lecturas programadas para este día.';
                    readingList.appendChild(li);
                }
            } else {
                const li = document.createElement('li');
                li.textContent = 'No hay lecturas programadas para este día.';
                readingList.appendChild(li);
            }
            
            // Actualizar el botón de completado
            updateCompleteButton(day, month, year);
            
            // Mostrar el modal
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        // Función para obtener las lecturas de un día específico
        function getDayReadings(day, month) {
            // Encontrar el mes correspondiente
            const monthData = readingPlan.find(m => m.month === month);
            if (!monthData || !monthData.readings) return [];
            
            // Obtener las lecturas del día específico (el índice es day-1 porque los arrays son base 0)
            const dayIndex = day - 1;
            if (dayIndex >= 0 && dayIndex < monthData.readings.length) {
                // Si hay lecturas para este día, devolverlas como un array
                const dailyReadings = monthData.readings[dayIndex];
                // Si dailyReadings es una cadena, dividirla por saltos de línea para crear un array
                return typeof dailyReadings === 'string' ? dailyReadings.split('\n').filter(Boolean) : [];
            }
            
            return [];
        }
        
        // Función para actualizar el botón de completado
        function updateCompleteButton(day, month, year) {
            const dateKey = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
            const completedDays = JSON.parse(localStorage.getItem('completedDays') || '{}');
            const isCompleted = !!completedDays[dateKey];
            
            completeDayBtn.textContent = isCompleted ? 'Completado' : 'Marcar como completado';
            completeDayBtn.classList.toggle('completed', isCompleted);
        }
        
        // Función para marcar un día como completado
        function toggleDayCompleted(day, month, year) {
            const dateKey = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
            const monthIndex = readingPlan.findIndex(m => m.month === month);
            const completedDays = JSON.parse(localStorage.getItem('completedDays') || '{}');
            const wasCompleted = !!completedDays[dateKey];
            
            if (wasCompleted) {
                delete completedDays[dateKey];
                // Restar del contador de días completados del mes
                if (monthIndex !== -1) {
                    readingPlan[monthIndex].completed = Math.max(0, readingPlan[monthIndex].completed - 1);
                }
            } else {
                completedDays[dateKey] = true;
                // Sumar al contador de días completados del mes
                if (monthIndex !== -1) {
                    readingPlan[monthIndex].completed = (readingPlan[monthIndex].completed || 0) + 1;
                }
            }
            
            // Guardar los cambios
            localStorage.setItem('completedDays', JSON.stringify(completedDays));
            saveProgress();
            
            // Actualizar la interfaz
            updateCompleteButton(day, month, year);
            updateDayInCalendar(day, month);
            updateOverallProgress();
            
            // Actualizar la barra de progreso del mes
            updateMonthProgress(month);
            
            // Cerrar el modal después de un breve retraso para dar feedback visual
            setTimeout(() => {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }, 300);
        }
        
        // Función para actualizar la apariencia de un día en el calendario
        function updateDayInCalendar(day, month) {
            // Actualizar tanto en el mes actual como en otros meses si están visibles
            const dayElements = document.querySelectorAll(`.month[data-month="${month}"] .day[data-day="${day}"]`);
            if (dayElements.length === 0) return;
            
            const dateKey = `${currentYear}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
            const completedDays = JSON.parse(localStorage.getItem('completedDays') || '{}');
            const isCompleted = !!completedDays[dateKey];
            
            // Actualizar todas las instancias de este día en el calendario
            dayElements.forEach(dayElement => {
                dayElement.classList.toggle('completed', isCompleted);
                
                // Añadir una clase temporal para resaltar el cambio
                dayElement.classList.add('just-updated');
                setTimeout(() => {
                    dayElement.classList.remove('just-updated');
                }, 500);
            });
        }
        
        // Event Listeners
        closeModalBtn.addEventListener('click', () => {
            modal.classList.remove('active');
            document.body.style.overflow = '';
        });
        
        completeDayBtn.addEventListener('click', () => {
            if (currentDay && currentMonth && currentYear) {
                toggleDayCompleted(currentDay, currentMonth, currentYear);
            }
        });
        
        // Cerrar modal al hacer clic fuera del contenido
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        });
        
        // Función para alternar el menú
        function toggleMenu() {
            const sideMenu = document.getElementById('side-menu');
            const overlay = document.getElementById('overlay');
            
            sideMenu.classList.toggle('active');
            overlay.classList.toggle('active');
            document.body.classList.toggle('menu-open');
        }
        
        // Cerrar menú al hacer clic en un enlace
        document.querySelectorAll('.side-menu a').forEach(link => {
            link.addEventListener('click', () => {
                toggleMenu();
            });
        });
        
        // Cerrar menú con la tecla Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const sideMenu = document.getElementById('side-menu');
                if (sideMenu.classList.contains('active')) {
                    toggleMenu();
                }
            }
        });
        
        // Inicializar la aplicación
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });
    </script>
</body>
</html>
